<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>dials</title>

    <script type="text/javascript" src="d3.min.js"></script>
    <script type="text/javascript" src="dial.chart.js"></script>
    <link rel=stylesheet href=style.css>

  </head>
<body>
  https://bl.ocks.org/dankronstal/b12b025d0eea52ad3f4a
  <button id="update" onclick="transition()">Update</button>
  <div id="chart">
  </div>
  <div id="my">
  </div>
  <script type="text/javascript">

    (function(chartselector) {

      var w = 1260,
          h = 500,
          scale= [ 0.71, 0.75, 0.76 ];

      var layout = [
      //  { x: 150, y: 250, r: 80, m: 220, ticks: 2, mark: 'line', needle:{color:'beige', circle: 2}, scale: scale  },
         { x: 400, y: 250, r: 150, m: 220, ticks: 4, mark: 'line', needle:{color:'#b21f24', circle: 2}, scale:scale   },
         //{ x: 610, y: 250, r: 40, m: 80, ticks: 2, mark: 'circle', needle:{color:'steelblue'}, scale:scale   },
          { x: 810, y: 250, r: 230, m: 80, ticks: 6, mark: 'line',
          needle:{color:'#fff', circle: 1, needle: [0.83, 0.02]},
          scale: [ 0.71, 0.875, 0.76 ]
        }
      ];
      var charts = layout.map(function(d) {
        return NBXDialChart()
          .width(d.r * 2)
          .height(d.r * 2)
          //.margin([ -50, -50, -50, -50 ])
          .scale(d.scale)
          .domain([0, d.m])
          .range([-135, 135])
          .minorTicks(d.ticks)
          .minorMark(d.mark)
          .needleParam(d.needle);
      });
      //console.log(charts);
      //console.log(charts[0].width());
      var svg = d3.select(chartselector)
          .append('svg:svg')
          .attr('width', w)
          .attr('height', h)
          .attr('style', 'background: #000')
          ;

      var dials = svg.selectAll('g.dial')
          .data(layout)
          .enter()
          .append('svg:g')
          .attr('class', 'dial')
          .attr('id', function(d, i) { return 'dial-' + i; })
          .attr('transform', function(d) { return 'translate(' + (d.x - d.r) + ',' + (d.y - d.r) + ')'; } )
          ;

          //console.log(dials);

      dials.each(function(d, i) { d3.select(this).data([15]).call(charts[i]); });

      window.transition = function() {
        var newr = Math.random()*200,
        newr1 = Math.random()*200;
        layout = [
          { x: 150, y: 250, r: newr1, m: 100, ticks: 2, mark: 'line' },
           { x: 460, y: 250, r: newr, m: 50, ticks: 4, mark: 'line' },
           //{ x: 910, y: 250, r: 60, m: 80, ticks: 2, mark: 'circle' }
        ];
        charts = layout.map(function(d) {
          return NBXDialChart()
            .width(d.r * 2)
            .height(d.r * 2)
            .domain([0, d.m])
            .range([-150, 150])
            .minorTicks(d.ticks)
            .minorMark(d.mark);
        });
        // charts[0].width = function() { return Math.random()*1000;}
        //     ;
            //console.log(charts[0].width());
        svg.selectAll('g.dial').remove();

        var dials = svg.selectAll('g.dial')
            .data(layout);
        dials.exit().remove();
        dials.enter()
            .append('svg:g')
            .attr('class', 'dial')
            .attr('id', function(d, i) { return 'dial-' + i; })
            .attr('transform', function(d) { return 'translate(' + (d.x - d.r) + ',' + (d.y - d.r) + ')'; } )
            ;

        dials.each(function(d, i) {
          d3.select(this)
            .data([ Math.random() * charts[i].domain()[1] ])
            .call(charts[i])
            ;
        });
      };

      // d3.select("#my")
      //   .append('svg:svg')
      //   .append("rect")
      //     .attr('width', 50)
      //     .attr('height', 200)
      //     .style("fill", "#666");


    })('#chart');

  </script>
  <div style="margin-left: 600px;background-color: #000;">
  <img src="download.png" width="400" style="padding: 20px 20px" />
  </div>
</body>
</html>
<!-- browser-sync start --server --directory --port "8080" --ui-port "9090" -->
